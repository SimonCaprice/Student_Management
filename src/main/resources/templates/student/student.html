<!doctype html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>学生管理系统</title>
  <header th:replace="header::html"></header>
</head>
<body class="index">
<div class="layui-card-body ">
  <form class="layui-form  layui-col-space5">
    <div class="layui-inline layui-show-xs-block">
      <input type="text" name="sid"  placeholder="请输入学号" autocomplete="off" class="layui-input">
    </div>
    <div class="layui-inline layui-show-xs-block">
      <button class="layui-btn"  lay-submit="" lay-filter="search"><i class="layui-icon">&#xe615;</i></button>
    </div>
    <button class="layui-btn" onclick="xadmin.open('添加用户','/student/add')" ><i class="layui-icon"></i>添加</button>
  </form>

</div>
<table class="layui-hide" id="test" lay-filter="test"></table>


<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>




<script th:inline="none">
  layui.use('table', function(){
    var table = layui.table;
    form = layui.form;
    table.render({
      elem: '#test'
      ,url:'/student/list'
      ,page: true
      ,response: {
        countName: 'count',
        dataName: 'datas'
      }
      ,title: '用户数据表'
      ,cols: [[
        {type: 'checkbox', fixed: 'left'}
        ,{field:'sid', title:'学号', width:120, fixed: 'left', unresize: true, sort: true}
        ,{field:'sname', title:'性名', width:80, edit: 'text'}
        ,{field:'ssex', title:'性别', width:50, edit: 'text', sort: true}
        ,{field:'sage', title:'年龄', width:100}
        ,{field:'snativeplace', title:'籍贯', width:100}
        ,{field:'smajor', title:'专业', width:120, sort: true}
        ,{field:'sclass', title:'班级', width:120}
        ,{field:'snative', title:'民族', width:100, sort: true}
        ,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}

      ]]
      ,done:function(){
        checkPermission()
      }
    });


    //监听行工具事件
    table.on('tool(test)', function(obj){
      var data = obj.data;
      //console.log(obj)
      if(obj.event === 'del'){
        layer.confirm('确定删除吗？', function(index){
          $.ajax({
            url:"/student/delete",
            type:"post",
            data:{'sid':data.sid},
            success:function (res) {
              if (res.code==200 || res.code==0){
                obj.del();//仅删除应行（tr）的Dom结构，并更行缓存
                layui.table.reload('demo');
                layer.close(index);
                console.log(index);
                layer.msg("删除成功",{icon:1});
              }else {
                layer.msg("删除失败",{icon:5});
              }

            }
          })
        });
      } else if(obj.event === 'edit'){
        layer.open({
          title:"修改",
          type:2,  //(iframe层) 类型是打开html页面
          area:['45%','70%'],      //弹出层宽高
          content:"/student/update",
          success:function (layero) {
            //获取当前打开的子页面id
            var sid = $(layero).find("iframe").contents().find("#updateid");
            var sname = $(layero).find("iframe").contents().find("#updatesname");
            var sage = $(layero).find("iframe").contents().find("#updatesage");
            var ssex = $(layero).find("iframe").contents().find("#updatessex");
            var snativeplace = $(layero).find("iframe").contents().find("#updatesnativeplace");
            var smajor = $(layero).find("iframe").contents().find("#updatesmajor");
            var sclass = $(layero).find("iframe").contents().find("#updatesclass");
            var snative = $(layero).find("iframe").contents().find("#updatesnative");
            //把当前页id值传给子页面
            sid.val(data.sid);
            sname.val(data.sname);
            sage.val(data.sage);
            ssex.val(data.ssex);
            snativeplace.val(data.snativeplace);
            smajor.val(data.smajor);
            sclass.val(data.sclass);
            snative.val(data.snative);

          }
        })
      }
    });
    //搜索
    form.on('submit(search)', function(data){
      var sid = data.field.sid;
      table.render({
        elem: '#test'
        ,url: '/student/search' //数据接口
        ,page: true //开启分页
        ,where:{
          "sid":sid
        }
        ,response: {

          countName: 'count', //规定数据总数的字段名称，默认：count
          dataName: 'datas' //规定数据列表的字段名称，默认：data
        }
        ,cols: [[
          {type: 'checkbox', fixed: 'left'}
          ,{field:'sid', title:'学号', width:80, fixed: 'left', unresize: true, sort: true}
          ,{field:'sname', title:'性名', width:120, edit: 'text'}
          ,{field:'ssex', title:'性别', width:80, edit: 'text', sort: true}
          ,{field:'sage', title:'年龄', width:100}
          ,{field:'snativeplace', title:'籍贯', width:100}
          ,{field:'smajor', title:'专业', width:80, sort: true}
          ,{field:'sclass', title:'班级', width:120}
          ,{field:'snative', title:'民族', width:100, sort: true}
          ,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}

        ]]
      });
      return false;
    });
    checkPermission();
  });
</script>
</body>
</html>